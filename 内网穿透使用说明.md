# 内网穿透使用说明

## 问题描述
使用节点小宝等内网穿透服务时，出现WebSocket连接错误：
```
NS_ERROR_WEBSOCKET_CONNECTION_REFUSED
Firefox 无法建立到 wss:/.../_stcore/stream 服务器的连接
```

## 解决方案

### 方案1：使用专用启动脚本 (推荐)
```bash
python run_tunnel.py
```

### 方案2：修改环境变量
在 `.env` 文件中设置：
```
DISABLE_WEBSOCKET=True
```
然后正常启动：
```bash
python run.py
```

### 方案3：使用配置文件
已创建 `.streamlit/config.toml` 配置文件，自动禁用WebSocket压缩。

## 内网穿透服务配置

### 节点小宝配置
1. 协议选择：HTTP
2. 本地端口：8080 (或您在.env中设置的端口)
3. 如果仍有问题，联系客服开启WebSocket支持

### 推荐的内网穿透服务
1. **ngrok** - 完全支持WebSocket
2. **frp** - 开源，支持WebSocket
3. **natapp** - 支持WebSocket
4. **花生壳** - 部分套餐支持WebSocket

## 验证方法
启动后检查控制台输出：
- 看到 "内网穿透模式 (WebSocket已禁用)" 表示配置成功
- 访问内网穿透提供的外网地址测试功能

## 注意事项
- 禁用WebSocket后，某些实时功能可能延迟
- 页面刷新频率会降低
- 建议使用支持WebSocket的内网穿透服务以获得最佳体验