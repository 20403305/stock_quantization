# 近期关注功能模块说明

## 功能概述

"近期关注"功能模块是一个智能的股票查询记录和推荐系统，能够自动记录用户的股票查询行为，并根据查询频次和时间进行智能排序推荐。

## 核心功能

### 1. 自动记录查询历史
- **自动记录**: 当用户查询任何股票时（除"近期关注"模块本身外），系统会自动记录查询信息
- **记录内容**: 股票代码、股票名称、数据源、查询时间、时间戳
- **存储方式**: JSON格式文件存储，位于 `web_app/recent_stocks.json`

### 2. 智能排序算法
- **频次权重**: 查询次数越多，权重越高
- **时间衰减**: 最近查询的股票权重更高，采用指数衰减算法
- **综合权重**: 频次 × 时间衰减因子，实现智能推荐

### 3. 丰富的展示界面
- **统计信息**: 显示关注股票数量、总查询次数、最近查询股票
- **排名列表**: 按关注度排序的股票列表，显示排名、代码、名称、查询次数、最近查询时间、关注度
- **快速选择**: 可从列表中选择股票进行快速查看
- **详细记录**: 显示单个股票的详细查询历史记录

### 4. 管理功能
- **清空记录**: 一键清空所有查询记录
- **刷新列表**: 手动刷新显示最新数据

## 技术实现

### 数据结构
```json
{
  "600519": [
    {
      "timestamp": 1761208424.373975,
      "stock_name": "贵州茅台",
      "data_provider": "tushare",
      "query_time": "2025-10-23 16:33:44",
      "symbol": "600519"
    }
  ]
}
```

### 核心函数

1. **`load_recent_stocks()`** - 加载近期关注数据
2. **`save_recent_stocks()`** - 保存近期关注数据
3. **`add_recent_stock()`** - 添加股票查询记录
4. **`get_recent_stocks_ranking()`** - 获取智能排序的股票列表
5. **`display_recent_stocks()`** - 显示近期关注界面

### 权重计算算法
```python
# 频次权重
frequency_weight = len(records)

# 时间权重（小时为单位）
time_weight = (当前时间 - 最近查询时间) / 3600

# 时间衰减因子（24小时衰减一半）
time_decay = 1 / (1 + time_weight / 24)

# 综合权重
combined_weight = frequency_weight * time_decay
```

## 使用流程

1. **启用功能**: 在侧边栏选择"近期关注"功能模块
2. **查看列表**: 点击"⭐ 查看近期关注"按钮
3. **选择股票**: 从排名列表中选择感兴趣的股票
4. **查看详情**: 查看该股票的详细查询记录
5. **快速分析**: 点击"快速分析"按钮跳转到其他分析功能

## 界面展示

### 统计信息区域
- 关注股票数量
- 总查询次数
- 最近查询的股票

### 排名列表区域
- 排名序号
- 股票代码和名称
- 查询次数
- 最近查询时间
- 关注度分数

### 快速选择区域
- 下拉选择框选择股票
- 显示选中股票的查询记录
- 快速分析按钮

### 管理功能区
- 清空所有记录按钮
- 刷新列表按钮

## 优势特点

1. **智能化**: 基于用户行为自动推荐
2. **个性化**: 每个用户的关注列表都是独特的
3. **实时性**: 查询记录实时更新
4. **易用性**: 界面直观，操作简单
5. **可扩展**: 数据结构支持未来功能扩展

## 数据安全

- 数据本地存储，不涉及用户隐私泄露
- 每个查询记录最多保留10条，避免数据膨胀
- 支持手动清空数据，保护用户隐私

## 未来扩展

1. **关注分组**: 支持按行业、概念等分组显示
2. **趋势分析**: 分析用户的关注趋势变化
3. **提醒功能**: 对关注股票的价格变动进行提醒
4. **数据导出**: 支持关注列表导出功能