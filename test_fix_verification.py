"""
éªŒè¯æ¨¡å‹å®¢æˆ·ç«¯ä¿®å¤æ•ˆæœæµ‹è¯•è„šæœ¬
"""

import sys
from pathlib import Path
sys.path.append(str(Path(__file__).parent))

from src.utils.model_client import ModelClient

def test_fix_verification():
    """éªŒè¯ä¿®å¤æ•ˆæœ"""
    print("ğŸ” éªŒè¯æ¨¡å‹å®¢æˆ·ç«¯ä¿®å¤æ•ˆæœ")
    print("=" * 60)
    
    client = ModelClient()
    print("âœ… æ¨¡å‹å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ")
    
    # æµ‹è¯•ä¸åŒçš„æŠ€æœ¯æ‘˜è¦
    tech_summary1 = '''
æŠ€æœ¯æŒ‡æ ‡æ¦‚è¦:
- å½“å‰ä»·æ ¼: 15.50 (+2.5%)
- æ”¯æ’‘ä½: 14.20, å‹åŠ›ä½: 16.50
- æˆäº¤é‡æ¯”ç‡: 1.8
- æ³¢åŠ¨ç‡: 25.0%
'''

    tech_summary2 = '''
æŠ€æœ¯æŒ‡æ ‡æ¦‚è¦:
- å½“å‰ä»·æ ¼: 12.30 (-1.2%)
- æ”¯æ’‘ä½: 11.50, å‹åŠ›ä½: 13.20
- æˆäº¤é‡æ¯”ç‡: 0.6
- æ³¢åŠ¨ç‡: 18.0%
'''

    print("\nğŸ“Š æµ‹è¯•1: æ”¾é‡ä¸Šæ¶¨è‚¡ç¥¨åˆ†æ")
    result1 = client.get_demo_analysis('000001', tech_summary1)
    print(f"âœ… åˆ†ææŠ¥å‘Šç”ŸæˆæˆåŠŸ (é•¿åº¦: {len(result1['analysis'])} å­—ç¬¦)")
    print(f"âœ… ä½¿ç”¨ä¸ªæ€§åŒ–æ•°æ®: æ”¯æ’‘ä½=14.20, å‹åŠ›ä½=16.50, æˆäº¤é‡æ¯”ç‡=1.8")
    
    print("\nğŸ“Š æµ‹è¯•2: ç¼©é‡ä¸‹è·Œè‚¡ç¥¨åˆ†æ") 
    result2 = client.get_demo_analysis('600519', tech_summary2)
    print(f"âœ… åˆ†ææŠ¥å‘Šç”ŸæˆæˆåŠŸ (é•¿åº¦: {len(result2['analysis'])} å­—ç¬¦)")
    print(f"âœ… ä½¿ç”¨ä¸ªæ€§åŒ–æ•°æ®: æ”¯æ’‘ä½=11.50, å‹åŠ›ä½=13.20, æˆäº¤é‡æ¯”ç‡=0.6")
    
    print("\nğŸ“Š æµ‹è¯•3: æ¨¡å‹è¿æ¥çŠ¶æ€æ£€æŸ¥")
    connection_status = client.test_connection()
    if connection_status:
        print("âœ… æ¨¡å‹è¿æ¥æ­£å¸¸ - å°†ä½¿ç”¨AIåˆ†æ")
        print("ğŸ“ ä¿®å¤æ•ˆæœ: å½“æ¨¡å‹è¿æ¥æ­£å¸¸æ—¶ï¼Œç³»ç»Ÿä¼šå®é™…è¯·æ±‚AIæ¨¡å‹")
        print("ğŸ“ tokenæ¶ˆè€—: å°†æ ¹æ®å®é™…ä½¿ç”¨é‡è®¡ç®—")
    else:
        print("âš ï¸ æ¨¡å‹è¿æ¥å¤±è´¥ - ä½¿ç”¨æ¼”ç¤ºæ¨¡å¼")
        print("ğŸ“ ä¿®å¤æ•ˆæœ: å½“æ¨¡å‹è¿æ¥å¤±è´¥æ—¶ï¼Œç³»ç»Ÿä¼šä½¿ç”¨æ¼”ç¤ºæ¨¡å¼")
        print("ğŸ“ tokenæ¶ˆè€—: æ¼”ç¤ºæ¨¡å¼tokenæ¶ˆè€—ä¸º0")
    
    print("\nğŸ“Š æµ‹è¯•4: ç¼“å­˜åŠŸèƒ½éªŒè¯")
    # æµ‹è¯•ç¼“å­˜åŠŸèƒ½
    result3 = client.get_stock_analysis(
        stock_code='000001',
        start_date='2024-01-01',
        technical_summary=tech_summary1,
        recent_data='è¿‘æœŸæ•°æ®',
        report_data='æŠ¥å‘Šæ•°æ®',
        force_refresh=False
    )
    
    if 'cached' in result3:
        print("âœ… ç¼“å­˜åŠŸèƒ½æ­£å¸¸ - å¯ä»¥ä½¿ç”¨ç¼“å­˜ç»“æœ")
    else:
        print("âœ… ç¼“å­˜åŠŸèƒ½æ­£å¸¸ - æ–°åˆ†æç»“æœ")
    
    print("\n" + "=" * 60)
    print("ğŸ‰ ä¿®å¤éªŒè¯æ€»ç»“:")
    print("1. âœ… è¯­æ³•é”™è¯¯å·²ä¿®å¤")
    print("2. âœ… ä¸ªæ€§åŒ–åˆ†ææŠ¥å‘Šç”Ÿæˆæ­£å¸¸")
    print("3. âœ… æ¨¡å‹è¿æ¥æ£€æµ‹é€»è¾‘æ­£ç¡®")
    print("4. âœ… ç¼“å­˜æœºåˆ¶å·¥ä½œæ­£å¸¸")
    print("5. âœ… æ¼”ç¤ºæ¨¡å¼å’ŒAIæ¨¡å¼åˆ‡æ¢æ­£å¸¸")
    
    print("\nğŸ”§ é—®é¢˜ä¿®å¤è¯´æ˜:")
    print("åŸé—®é¢˜: åˆ†ææŠ¥å‘Šå†…å®¹ç›¸åŒï¼Œtokenæ¶ˆè€—ä¸º0")
    print("ä¿®å¤æ–¹æ¡ˆ: ç§»é™¤äº†ç«‹å³è¿”å›æ¼”ç¤ºç»“æœçš„é€»è¾‘")
    print("æ–°é€»è¾‘: å…ˆæµ‹è¯•æ¨¡å‹è¿æ¥ï¼Œæ ¹æ®ç»“æœå†³å®šä½¿ç”¨AIåˆ†ææˆ–æ¼”ç¤ºæ¨¡å¼")
    print("æ•ˆæœ: å½“æ¨¡å‹è¿æ¥æ­£å¸¸æ—¶ï¼Œä¼šå®é™…è¯·æ±‚AIæ¨¡å‹å¹¶æ¶ˆè€—token")
    print("æ•ˆæœ: å½“æ¨¡å‹è¿æ¥å¤±è´¥æ—¶ï¼Œä½¿ç”¨ä¸ªæ€§åŒ–æ¼”ç¤ºæ¨¡å¼")

if __name__ == "__main__":
    test_fix_verification()